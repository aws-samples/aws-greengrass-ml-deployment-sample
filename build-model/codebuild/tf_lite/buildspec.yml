  
version: 0.2

phases:
  install:
    runtime-versions:
      python: 3.7
    commands:
      - pip install tensorflow
  build:
    commands:
      - python build_model.py
      - curl https://storage.googleapis.com/download.tensorflow.org/data/ImageNetLabels.txt -O
      - pip3 install https://dl.google.com/coral/python/tflite_runtime-2.1.0.post1-cp36-cp36m-linux_x86_64.whl -t dependencies
      - mkdir -p model_package
      - mv model.tflite ImageNetLabels.txt dependencies model_package
      - tar -zcvf model-package.tar.gz -C model_package .
      - timestampStr=$(date +%y-%m-%d-%H-%M-%S)
      - aws s3 cp model-package.tar.gz s3://${BUILD_ARTIFACT_BUCKET}/models/image-net-tf-lite-${timestampStr}/model.tar.gz
      - echo "Uploaded final package to s3://${BUILD_ARTIFACT_BUCKET}/models/image-net-tf-lite-${timestampStr}/model.tar.gz"
    artifacts:
      files:
        - '**/*'
      base-directory: 'model_package'
      
